<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Vue Standalone Demo</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"
            integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.3.6/dist/vuetify.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vuetify@3.3.6/dist/vuetify.min.css">
</head>
<body>
<div id="app">
    <div>
        <div v-for="keyframe in keyframes" class="container">
            <div class="timecode">
                {{ keyframe.elapsed }}
            </div>
            <div style="width: 100%">
                <v-combobox height="40px" class="ma-0 pa-0" solo density="compact" :items="keyframe.candidates"
                            :menu-props="{padding: '0px', density: 'compact'}" v-model="keyframe.note" @update:model-value="saveNote(keyframe)"></v-combobox>
            </div>
        </div>
    </div>
</div>
<script>
    const {createApp} = Vue
    const {createVuetify} = Vuetify

    const vuetify = createVuetify()


    app = createApp({
        components: {},
        data() {
            return {
                message: 'Hello Vue!',

                keyframes: []
            }
        },
        methods: {
            loadKeyframes() {
                fetch("http://localhost:8080/keyframes")
                    .then(res => res.json())
                    .then(obj => this.keyframes = obj)
            },
            saveNote(keyframe) {
                fetch("http://localhost:8080/update-note?" + new URLSearchParams({
                    "id": keyframe.id,
                    "note": keyframe.note
                }), {method: "POST"})
            },
            addKeyframe(keyframe) {
                this.keyframes.push(keyframe)
            },
            addCandidate(id, text) {
                const keyframe = this.keyframes.find(x => x.id === id)
                keyframe.candidates.push(text)
            }
        },
        created() {
            this.loadKeyframes()
        },
    }).use(vuetify).mount('#app')

    io = io("http://localhost:8080");
    io.on("new-keyframe", (record) => {
        app.addKeyframe(record)
    })
    io.on("new-candidate", (id, text) => {
        app.addCandidate(id, text)
    })
</script>
</body>
<style>
    :root {
        --main-color: #fff;
        --element-radius: 1em;
        --obs-background: #3a393a;
        --obs-button-background: #4c4c4c;
        --obs-button-border: #233166;
        --obs-button-hover-background: #581624;
        --obs-button-hover-border: #84162d;
        --obs-button-color: #fff;
        --vs-line-height: 1.5;
    }

    .v-input__details {
        display: none;
    }

    .v-list-item--density-default.v-list-item--one-line {
        padding: 0;
        min-height: 10px;
    }

    .v-list {
        padding: 0;
    }

    .v-list__tile {
        padding: 0
    }

    body {
        font-size: 14px;
        margin: 0;
        background-color: var(--obs-background);
        font-family: "Roboto";
    }

    .v-field {
        font-size: 14px;
    }

    .v-list-item-title {
        font-size: 14px;
    }


    .container {
        display: flex;
        gap: 10px;
        margin: 10px;
    }

    .timecode {
        padding: 0.5rem;
    }

    .text-input {
        /*box-sizing: border-box;*/
        padding: .5em;
        /*margin: 0 0 1em;*/
        border: none;
        width: 100%;
    }

    button {
        background: var(--obs-button-background);
        border: 0px solid var(--obs-button-border);
        color: var(--obs-button-color);
        padding: .5em;
        border-radius: 3px;
        text-align: center;
    }

    button:hover {
        background: #7a797a;
    }

    #app {
        color: var(--main-color);
    }

    .v-input {
        font-size: 10px;
    }

    .vs__selected {
        color: var(--main-color);
    }

    .vs__dropdown-toggle {
        background: #1f1e1f;
    }

    .vs__dropdown-option--highlight {
        background: #1f1e1f;
    }

    .vs__dropdown-menu {
        background: #7a797a;
        border: none;
        color: var(--main-color);
        text-transform: lowercase;
        font-variant: small-caps;
    }

    .vs__selected-options {
        flex-wrap: nowrap;
        max-width: calc(100% - 25px); /* change this to `- 40px` if you're supporting a `clearable` field; I was not */
    }

    .vs__selected {
        display: block;
        white-space: nowrap;
        text-overflow: ellipsis;
        max-width: 100%;
        overflow: hidden;
    }
</style>
</html>
